patch:
  schema:
    schema_id: terra_pinyin
    name: åœ°çƒæ‹¼éŸ³-è–„è·å®šåˆ¶
    version: '0.20'
    author:
      - ä½›æŒ¯ <chen.sst@gmail.com>
      - mintimate < @Mintimate|https://www.mintimate.cn >
    description: |
      ã€Œæ¼¢èªæ‹¼éŸ³ã€ï¼Œä»¥ç¬¦è™ŸæŒ‰éµ - / < \ è¼¸å…¥å››è²
      æ‹¼éŸ³ç¢¼è¡¨æ ¹æ“š CC-CEDICT æ”¹ç·¨
    dependencies:
      - wubi86_jidian
      - stroke
      - chaizi # https://github.com/MaxChang3/rime-chaizi
      - melt_eng # è‹±æ–‡æ–¹æ¡ˆ
  
  switches:
    - name: ascii_mode
      reset: 0
      states: [ ä¸­æ–‡, è‹±æ–‡ ]
    - name: emoji_suggestion
      reset: 1
      states: [ "ğŸ˜£ï¸","ğŸ˜ï¸"]
    - name: full_shape
      states: [ åŠè§’, å…¨è§’ ]
    - name: simplification
      reset: 1
      states: [ ç¹ä½“, ç®€ä½“ ]
    - name: ascii_punct
      states: [ ã€‚ï¼Œ, ï¼ï¼Œ ]

  key_binder:
    bindings:
      - {accept: "Control+Shift+E", toggle: emoji_suggestion, when: always}
      - {accept: "Control+Shift+1", toggle: simplification, when: has_menu}
      - {accept: bracketleft, send: Page_Up, when: paging}      # ä½¿ç”¨`[`è¿›è¡Œå‘ä¸Šç¿»é¡µï¼ˆç¬¬ä¸€é¡µæ—¶å€™æ— æ•ˆï¼‰
      - {accept: bracketright, send: Page_Down, when: has_menu} # ä½¿ç”¨`]`è¿›è¡Œå‘ä¸‹ç¿»é¡µ
      - {accept: minus, send: Page_Up, when: paging}     # ä½¿ç”¨`-`è¿›è¡Œå‘ä¸Šç¿»é¡µï¼ˆç¬¬ä¸€é¡µæ—¶å€™æ— æ•ˆï¼‰
      - {accept: equal, send: Page_Down, when: has_menu} # ä½¿ç”¨`=`è¿›è¡Œå‘ä¸‹ç¿»é¡µ
  
  engine:
    processors:
      - ascii_composer
      - recognizer
      - key_binder
      - speller
      - punctuator
      - selector
      - navigator
      - express_editor
    segmentors:
      - ascii_segmentor
      - matcher
      - affix_segmentor@wubi86_jidian
      - affix_segmentor@chaizi
      - affix_segmentor@stroke
      - abc_segmentor
      - punct_segmentor
      - fallback_segmentor
    translators:
      - lua_translator@date_translator
      - lua_translator@time_translator
      - lua_translator@week_translator
      - punct_translator
      - table_translator@custom_phrase
      - table_translator@melt_eng  # è‹±æ–‡è¾“å…¥ï¼ˆä½œä¸ºå­ç¿»è¯‘å™¨ï¼Œä¼˜å…ˆçº§éœ€è¦æ¯”åŸç”Ÿçš„ä½ï¼‰
      - reverse_lookup_translator@wubi86_jidian
      - reverse_lookup_translator@chaizi
      - reverse_lookup_translator@stroke
      - script_translator
    filters:
      - simplifier@emoji_suggestion
      - simplifier@simplification
      - simplifier
      - uniquifier
    emoji_suggestion:
      opencc_config: emoji.json
      option_name: emoji_suggestion

  # ç®€ç¹åˆ‡æ¢
  simplification:
    option_name: simplification
    opencc_config: s2t.json             # s2t.json | s2hk.json | s2tw.json | s2twp.json
    tips: none                          # è½¬æ¢æç¤º: all éƒ½æ˜¾ç¤º | char ä»…å•å­—æ˜¾ç¤º | none ä¸æ˜¾ç¤ºã€‚
    excluded_types: [ reverse_lookup ]  # ä¸è½¬æ¢åæŸ¥ï¼ˆä¸¤åˆ†æ‹¼å­—ï¼‰çš„å†…å®¹
  
  speller:
    alphabet: 'zyxwvutsrqponmlkjihgfedcba-;/<,>\'
    initials: zyxwvutsrqponmlkjihgfedcba
    delimiter: " '"
    algebra:
      - xform/^r5$/er5/
      - erase/^xx$/
      - derive/^([zcs])h/$1/ # zh, ch, sh => z, c, s
      - derive/^([zcs])([^h])/$1h$2/ # z, c, s => zh, ch, sh
      - derive/([aei])n$/$1ng/ # en => eng, in => ing
      - derive/([aei])ng$/$1n/ # eng => en, ing => in
      - derive/([iu])an$/$lang/ # ian => iang, uan => uang
      - derive/([iu])ang$/$lan/ # iang => ian, uang => uan
      - derive/([aeiou])ng$/$1gn/        # dagn => dang
      - derive/([dtngkhrzcs])o(u|ng)$/$1o/  # zho => zhong|zhou
      - derive/ong$/on/                  # zhonguo => zhong guo
      - derive/ao$/oa/                   # hoa => hao
      - derive/([iu])a(o|ng?)$/a$1$2/    # tain => tian
      - abbrev/^([a-z]).+$/$1/
      - abbrev/^([zcs]h).+$/$1/
      - derive/^([nl])ve/$1ue/
      - derive/^([jqxy])u/$1v/
      - derive/([dtnlgkhrzcs])un/$1uen/
      - derive/ui/uei/
      - derive/iu/iou/
      - derive/ao/oa/
      - derive/([aeiou])ng/$1gn/
      - derive/([iu])a(o|ng?)/a$1$2/
      - derive/^([a-z]+)[0-5]$/$1/
      - derive/([dtngkhrzcs])o(u|ng)$/$1o/
      - derive/ong$/on/
      - 'erase/^.*5$/'
      - 'xlit 1234 -/<\'
      - 'derive/^(.*)-$/$1;/'
      - 'derive/^(.*)<$/$1,/'
      - 'derive/^(.*)\\$/$1>/'
  
  translator:
    dictionary: custom_dict_terra.all
    spelling_hints: 3  # ï½å­—ä»¥å…§å€™é¸æ¨™è¨»å®Œæ•´å¸¶èª¿æ‹¼éŸ³
    preedit_format:
      - xform/([nl])v/$1Ã¼/
      - xform/([nl])ue/$1Ã¼e/
      - xform/([nl])Ã¼en/$1uen/
      - xform/([jqxy])v/$1u/
      - xform/eh/Ãª/
      - 'xform ([aeiou])(ng?|r)([-;/<,>\\]) $1$3$2'
      - 'xform ([aeo])([iuo])([-;/<,>\\]) $1$3$2'
      - 'xform a[-;] Ä'
      - 'xform a/ Ã¡'
      - 'xform a[<,] Ç'
      - 'xform a[>\\] Ã '
      - 'xform e[-;] Ä“'
      - 'xform e/ Ã©'
      - 'xform e[<,] Ä›'
      - 'xform e[>\\] Ã¨'
      - 'xform o[-;] Å'
      - 'xform o/ Ã³'
      - 'xform o[<,] Ç’'
      - 'xform o[>\\] Ã²'
      - 'xform i[-;] Ä«'
      - 'xform i/ Ã­'
      - 'xform i[<,] Ç'
      - 'xform i[>\\] Ã¬'
      - 'xform u[-;] Å«'
      - 'xform u/ Ãº'
      - 'xform u[<,] Ç”'
      - 'xform u[>\\] Ã¹'
      - 'xform Ã¼[-;] Ç–'
      - 'xform Ã¼/ Ç˜'
      - 'xform Ã¼[<,] Çš'
      - 'xform Ã¼[>\\] Çœ'
    comment_format:
      - xform ([aeiou])(ng?|r)([1234]) $1$3$2
      - xform ([aeo])([iuo])([1234]) $1$3$2
      - xform a1 Ä
      - xform a2 Ã¡
      - xform a3 Ç
      - xform a4 Ã 
      - xform e1 Ä“
      - xform e2 Ã©
      - xform e3 Ä›
      - xform e4 Ã¨
      - xform o1 Å
      - xform o2 Ã³
      - xform o3 Ç’
      - xform o4 Ã²
      - xform i1 Ä«
      - xform i2 Ã­
      - xform i3 Ç
      - xform i4 Ã¬
      - xform u1 Å«
      - xform u2 Ãº
      - xform u3 Ç”
      - xform u4 Ã¹
      - xform v1 Ç–
      - xform v2 Ç˜
      - xform v3 Çš
      - xform v4 Çœ
      - xform/([nljqxy])v/$1Ã¼/
      - xform/eh[0-5]?/Ãª/
      - xform/([a-z]+)[0-5]/$1/
  
  custom_phrase:
    dictionary: ""
    user_dict: custom_phrase
    db_class: stabledb
    enable_completion: false
    enable_sentence: false
    initial_quality: 1

  melt_eng:
    dictionary: custom_dict_en.all # è‹±æ–‡è¯å…¸
    enable_sentence: false         # å…³é—­è‡ªåŠ¨é€ å¥
    enable_completion: false       # å…³é—­è‡ªåŠ¨æç¤º
    initial_quality: 0.8

  wubi86_jidian:
    tag: wubi86_jidian
    dictionary: wubi86_jidian
    enable_user_dict: false
    enable_completion: true
    prefix: "`"
    suffix: "'"
    tips: ã€”äº”ç¬”ã€•
    comment_format:
      - xform ([aeiou])(ng?|r)([1234]) $1$3$2
      - xform ([aeo])([iuo])([1234]) $1$3$2
      - xform a1 Ä
      - xform a2 Ã¡
      - xform a3 Ç
      - xform a4 Ã 
      - xform e1 Ä“
      - xform e2 Ã©
      - xform e3 Ä›
      - xform e4 Ã¨
      - xform o1 Å
      - xform o2 Ã³
      - xform o3 Ç’
      - xform o4 Ã²
      - xform i1 Ä«
      - xform i2 Ã­
      - xform i3 Ç
      - xform i4 Ã¬
      - xform u1 Å«
      - xform u2 Ãº
      - xform u3 Ç”
      - xform u4 Ã¹
      - xform v1 Ç–
      - xform v2 Ç˜
      - xform v3 Çš
      - xform v4 Çœ
      - xform/([nljqxy])v/$1Ã¼/
      - xform/eh[0-5]?/Ãª/
      - xform/([a-z]+)[0-5]/$1/

  stroke:
    tag: stroke
    dictionary: stroke
    enable_user_dict: false
    prefix: 'i'
    suffix: "'"
    tips: ã€”ç¬”ç”»ã€•
    preedit_format:
      - xlit/hspnz/ä¸€ä¸¨ä¸¿ä¸¶ä¹™/
    comment_format:
      - xform/([nl])v/$1Ã¼/
      - xform ([aeiou])(ng?|r)([1234]) $1$3$2
      - xform ([aeo])([iuo])([1234]) $1$3$2
      - xform a1 Ä
      - xform a2 Ã¡
      - xform a3 Ç
      - xform a4 Ã 
      - xform e1 Ä“
      - xform e2 Ã©
      - xform e3 Ä›
      - xform e4 Ã¨
      - xform o1 Å
      - xform o2 Ã³
      - xform o3 Ç’
      - xform o4 Ã²
      - xform i1 Ä«
      - xform i2 Ã­
      - xform i3 Ç
      - xform i4 Ã¬
      - xform u1 Å«
      - xform u2 Ãº
      - xform u3 Ç”
      - xform u4 Ã¹
      - xform v1 Ç–
      - xform v2 Ç˜
      - xform v3 Çš
      - xform v4 Çœ
      - xform/([nljqxy])v/$1Ã¼/
      - xform/eh[0-5]?/Ãª/
      - xform/([a-z]+)[0-5]/$1/

  chaizi:
    tag: chaizi
    dictionary: chaizi
    enable_completion: true
    prefix: "u"
    preedit_format:
      - xform/([nljqxy])v/$1Ã¼/
    comment_format:
      - xform/([nljqxy])v/$1Ã¼/
      - xform ([aeiou])(ng?|r)([1234]) $1$3$2
      - xform ([aeo])([iuo])([1234]) $1$3$2
      - xform a1 Ä
      - xform a2 Ã¡
      - xform a3 Ç
      - xform a4 Ã 
      - xform e1 Ä“
      - xform e2 Ã©
      - xform e3 Ä›
      - xform e4 Ã¨
      - xform o1 Å
      - xform o2 Ã³
      - xform o3 Ç’
      - xform o4 Ã²
      - xform i1 Ä«
      - xform i2 Ã­
      - xform i3 Ç
      - xform i4 Ã¬
      - xform u1 Å«
      - xform u2 Ãº
      - xform u3 Ç”
      - xform u4 Ã¹
      - xform v1 Ç–
      - xform v2 Ç˜
      - xform v3 Çš
      - xform v4 Çœ
      - xform/([nljqxy])v/$1Ã¼/
      - xform/eh[0-5]?/Ãª/
      - xform/([a-z]+)[0-5]/$1/
    tips: ã€”æ‹†å­—ã€•


  reverse_lookup:
    tags: [wubi86_jidian,stroke,chaizi]
    overwrite_comment: false

  
  punctuator:
    import_preset: default
  
  key_binder:
    import_preset: default
    bindings:
      - { when: has_menu, accept: minus, send: minus }  # tone 1
      - { when: paging, accept: minus, send: Page_Up }
  
  recognizer:
    import_preset: default
    patterns:
      punct: "^/([0-9]0?|[a-z]+)$"
      wubi86_jidian: "`[a-z]*'?$"
      stroke: "i[a-z]*'?$"
      chaizi: "u[a-z]*'?$"

  __patch:
    - terra_symbols:/patch?
